spring:
  application:
    name: downloader-bot
  config:
    import: optional:file:.env[.properties]
  profiles:
    default: dev
  jackson:
    property-naming-strategy: SNAKE_CASE
    deserialization:
      fail-on-unknown-properties: false
    mapper:
      accept-case-insensitive-enums: true

management:
  server:
    address: 0.0.0.0
    port: 8081
  endpoint:
    health:
      probes:
        enabled: true

logging:
  level:
    root: INFO

telegram:
  bot:
    token: ${TELEGRAM_BOT_TOKEN}
    default-command: download

downloader:
  media:
    base-dir: /downloads
    max-size:
      photo: 10MB
      video: 50MB
    cleanup:
      max-age: 7d
      max-total-size: 10GB
      interval: 1h
      initial-delay: 5m
  sources:
    allow:
      - ^https?://([a-z0-9-]+\.)?tiktok\.com/@[^/]+/video/\d+(?:/|(?:\?.*)?)?$
      - ^https?://([a-z0-9-]+\.)?tiktok\.com/video/\d+(?:/|(?:\?.*)?)?$
      - ^https?://(www\.|m\.)?youtube\.com/shorts/[A-Za-z0-9_-]{11}(?:\?.*)?$
  yt-dlp:
    enabled: true
    bin: yt-dlp
    format: 137+140/136+140/135+140/134+140/18/b[ext=mp4]/b
    timeout: 2m
  gallery-dl:
    enabled: false
    bin: gallery-dl
    timeout: 1m
  cache:
    media-ttl: 7d
    lock-ttl: 60s
    wait-timeout: 60s
    wait-poll: 1s
  concurrency:
    max-downloads: 5
  ratelimit:
    enabled: true
    namespace: rl
    global:
      capacity: 30
      refill:
        tokens: 30
        period: 1s
        greedy: true
    chat:
      capacity: 1
      refill:
        tokens: 1
        period: 1s
        greedy: true
    group:
      # max 20
      capacity: 5
      refill:
        tokens: 5
        period: 1m
        greedy: true
